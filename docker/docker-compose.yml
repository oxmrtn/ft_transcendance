# Chemin du fichier : FT_TR.../docker/docker-compose.yml

services:
  # 1. Service Back-end (Node.js / API)
  backend:
    build:
      context: ..
      dockerfile: ./docker/backend/Dockerfile
    container_name: transcendance-backend
    ports:
      - "3000:3000"
    volumes:
      # 1. Synchronisation du code source :
      - ../srcs/back:/usr/src/app 
      
      # üí• CORRECTION EXPRESS/NODE_MODULES : Ce volume anonyme masque le 'node_modules' 
      # de l'h√¥te et utilise celui qui a √©t√© install√© dans l'image lors du build.
      - /usr/src/app/node_modules 
      
      # 2. PERMANENCE DE LA BASE DE DONN√âES SQLite (Le chemin de l'h√¥te a √©t√© corrig√© pour utiliser 'srcs/back')
      # NOTE: Si votre dossier 'data' doit √™tre √† la racine, utilisez '..//data'
      - ../srcs/back/data:/usr/src/app/data 
      
    environment:
      - DATABASE_PATH=/usr/src/app/data/pong.sqlite

  # 2. Service Front-end (Nginx)
  frontend:
    build:
      context: .. 
      dockerfile: ./docker/frontend/Dockerfile
    container_name: transcendance-frontend
    ports:
      - "8080:80"
    volumes:
      # Synchronisation du code source du front-end
      - ../srcs/front:/app 
      - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      
    depends_on:
      - backend
      
networks:
  default: {}